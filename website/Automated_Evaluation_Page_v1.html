<!DOCTYPE html>
<!--
    <div>Icons made by <a href="https://www.flaticon.com/authors/gregor-cresnar" title="Gregor Cresnar">Gregor Cresnar</a> from <a href="https://www.flaticon.com/" 			    title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" 			    title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>

    <div>Icons made by <a href="https://www.flaticon.com/authors/becris" title="Becris">Becris</a> from <a href="https://www.flaticon.com/" 			    title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" 			    title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
-->
<html lang="en">
	<head>
        <title>Automate Evaluation Page</title>
        <style>
            button{
                width: auto;
                margin: 10px 0;
                height: 33px;
            }
            #charts{
                height: 580px;
            }
            body
			{
				background-color:rgb(255, 255, 255);
				color:#000000;
			}
			/* TABLE STYLING*/
			#table-container
			{
				position: relative;
				width: 100%;
				height: 550px;
				background: white;
				padding-top: 54px;
				overflow: hidden;
			}
			#table-container-inner
			{
				overflow-x: auto;
				overflow-y: auto;
				height: 100%;
			}

			#table-header-fixed
			{
				width: 100%;
				background: white;
				overflow-x: auto;
				overflow-y: auto;
				border-collapse:collapse;
				border-spacing:0;
				width:100%;
				display:table;
				color:#5d5d5d;
			}
			th, td, span
			{
				text-align: left; 
                padding: 8px 25px ;
			}

			tbody tr
			{
				border-bottom:1px solid #ddd;
				font-size: 11px;
				margin: 0;
			}
			tbody td
			{
				padding:4px 8px;
				width: 100px;
			}

			tbody tr:nth-child(odd){background-color:#fff}
			tbody tr:nth-child(even){background-color:#f1f1f1}

			th
			{
				padding: 0;
			}
			#tableHead
			{
				position: absolute;
				top: 0;
				width: 100%;
				line-height: 45px;
				font-size: 12px;
				color: white;
				padding-left: 4px;
				background: rgb(37, 129, 191);
				border: 2px solid rgb(37, 129, 191);
			}
			span:hover
			{
				cursor: pointer;
			}

			tbody
			{
				position: relative;
			}



            ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  /*background-color: #333;
  */
  background-color: rgb(37, 129, 191);
}

li {
  float: left;
  color: black;
  /*border-right:1px solid #bbb;*/
}
/*
li:last-child {
  border-right: none;
}*/

li input {
  /*display: block;*/
  color: rgb(201, 199, 199);
  text-align: left;
  padding: 14px 16px;
  text-decoration: none;

}
a{
    color: white;
}
        </style>
        <link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
        
        <div id="header">
            <ul>
                <li>
                    <label for="files" class="custom-file-upload">
                        <span id="upload-icon"></span> Choose Files
                    </label>
                    <input id="files" type="file" multiple onchange="processFiles()"/>
                </li>
                <li id="selectGraph">
                    <p>Select Chart Type</p>
                    <p>
                        <input id="barType" type="radio" name="charttype" value="bar" onchange="SetBar()">
                        <label for="barType">Bar</label>
                        <input id="lineType" type="radio" name="charttype" value="line" onchange="SetLine()" > 
                        <label for="lineType">Line</label>
                    </p>
                </li>
                <li id="sortTable">
                    <p>Sort Table By</p>
                    <p>
                        <select onchange="SortTable(this.value,'N')">
                            <option value="0">Type</option>
                            <option value="1">Version</option>
                            <option value="2">CPU</option>
                            <option value="3">SubType</option>
                            <option value="4">OS</option>
                            <option value="5">Lasal</option>
                            <option value="6">Loader</option>
                            <option value="7">Compiler</option>
                            <option value="8">Time0</option>
                            <option value="9">Time1</option>
                            <option value="10">Time2</option>
                            <option value="11">Time3</option>
                            <option value="12">Time4</option>
                            <option value="13">Time5</option>
                            <option value="14">Time6</option>
                            <option value="15">Time7</option>
                            <option value="16">Time8</option>
                        </select>
                    </p>
                </li>
                <li>
                    <img id="SigLogo" src="sigmatek.png" alt="SIGMATEK">
                </li>
                <li id="refreshContainer">
                    <button onClick="window.location.reload()" name="Refresh" id="refreshButton"></button>
                </li>
            </ul>
        </div>

        

        <div id="charts">
            <div id="chart">
            </div>
            <div id="chart2">
            </div>
        </div>
     <!--    <p> Sort By:  
               <button type="radio" onclick="SortTable(1,'N')">Sort</button>
            <select onchange="SortTable(this.value,'N')">
                <option value="0">Type</option>
                <option value="1">Version</option>
                <option value="2">CPU</option>
                <option value="3">SubType</option>
                <option value="4">OS</option>
                <option value="5">Lasal</option>
                <option value="6">Loader</option>
                <option value="7">Compiler</option>
                <option value="8">Time0</option>
                <option value="9">Time1</option>
                <option value="10">Time2</option>
                <option value="11">Time3</option>
                <option value="12">Time4</option>
                <option value="13">Time5</option>
                <option value="14">Time6</option>
                <option value="15">Time7</option>
                <option value="16">Time8</option>
            </select>
        </p>-->
        <div id="table-container">

            <div id="table-container-inner" onscroll="handleScroll()">

                <div class="pane pane--table2"  id="myTable">
        
                </div>
            </div>
        </div>
 
        <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>

        <script>
            window.entryList;
            window.myChartTyp = 'bar';
            window.chartOptions;
            window.createdBar;
            window.createdLine;
            window.loadedFiles;
            window.myCharts;

            class XMLTags{
				constructor(type, version, cpu, subType, os, lasal, loader, compiler, time0,time1,time2,time3,time4,time5,time6,time7,time8)
				{
					this.type = type;
					this.version = version,
					this.cpu = cpu;
					this.subType = subType;
					this.os = os;
					this.lasal = lasal;
					this.loader = loader;
					this.compiler = compiler;
					this.time0 = time0;
                    this.time1 = time1;
                    this.time2 = time2;
                    this.time3 = time3;
                    this.time4 = time4;
                    this.time5 = time5;
                    this.time6 = time6;
                    this.time7 = time7;
                    this.time8 = time8;
				}
            }

            // Call Function onchange
            function processFiles()
            {
                window.createdLine = 0;
                window.createdBar = 0;
                // get Reference
                var filelist = document.getElementById('files').files;
                for(var i=0; i<filelist.length; i++)
                {
                    writefiles(filelist[i]);
                }
            }
        
            function writefiles(file)
            {
                window.entryList = [];
                var reader = new FileReader();
                reader.onload = function()
                {
                  // Hier Parsen  

                  parser = new DOMParser();
							var txt = '<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<Measurements>\n';
							xmlDoc = parser.parseFromString(txt +reader.result + '\n</Measurements>\n',"text/xml");
							
							for (i = 0; i < xmlDoc.getElementsByTagName("Entry").length; i++)
							{
								// create the Entries
								var type, version, cpu, subType, os, lasal, loader, compiler,time0, time1,time2, time3,time4, time5,time6, time7,time8;
								//var times = [];
								
								type = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Typ");
								version = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Lib");
								cpu = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("CPU");
								subType = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("SubTyp");
                                time0 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time0").split("/")[1]; //PowerOn
                                time1 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time1").split("/")[1]; //PowerOff
                                time2 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time2").split("/")[1]; //MoveAbsolute
                                time3 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time3").split("/")[1]; //StopMove
                                time4 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time4").split("/")[1]; //StopMove
                                time5 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time5").split("/")[1]; //StopMove
                                time6 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time6").split("/")[1]; //MOVE
                                time7 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time7").split("/")[1]; //MOVE
                                time8 = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Time8").split("/")[1]; //LOCKED
								os = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Info").slice(0,12);
								lasal = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Info").slice(13,28);
								loader = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Info").slice(29,45);
								compiler = xmlDoc.getElementsByTagName("Entry")[i].getAttribute("Info").slice(45,60);

                                var entry = new XMLTags(type, version, cpu, subType, os, lasal, loader, compiler, time0,time1,time2,time3,time4,time5,time6,time7,time8);
								window.entryList.push(entry);
							}
                    
                    CreateTable();
                   // alert("This is the entry" + entryList);
                    console.log(window.entryList);
                   // SetBar();
                }
                reader.readAsText(file, "UTF-8");
            }

            function CreateTable() {
                var myEntrys = window.entryList;
                 
                var nofEntrys = myEntrys.length;
                
                if(nofEntrys>0){
                    
        
                    // CREATE DYNAMIC TABLE.
                    var table = document.createElement("table");
                  /*  table.style.width = '50%';
                    table.setAttribute('border', '1');
                    table.setAttribute('cellspacing', '0');
                    table.setAttribute('cellpadding', '8');
                    table.id = "table-header-fixed";
                    */
                   table.setAttribute('id','table-header-fixed')
                    // retrieve column header ('Name', 'Email', and 'Mobile')
        
                    var col = []; // define an empty array
                    for (var i = 0; i < nofEntrys; i++) {
                        for (var key in myEntrys[i]) {
                            if (col.indexOf(key) === -1) {
                                col.push(key);
                            }
                        }
                    }
                    
                    // CREATE TABLE HEAD .
                    var tHead = document.createElement("thead");
                    tHead.setAttribute('id','tableHead'); 
                    
                    // CREATE ROW FOR TABLE HEAD .
                    var hRow = document.createElement("tr");
                    
                    // ADD COLUMN HEADER TO ROW OF TABLE HEAD.
                    for (var i = 0; i < col.length; i++) {
                            var th = document.createElement("th");
                            th.innerHTML = col[i];
                            hRow.appendChild(th);
                            th.style.padding = '12px 39px';
                    }
                    tHead.appendChild(hRow);
                    table.appendChild(tHead);

                    
                    // CREATE TABLE BODY .
                    var tBody = document.createElement("tbody");	
                    
                    // ADD COLUMN HEADER TO ROW OF TABLE HEAD.
                    for (var i = 0; i < nofEntrys; i++) {
                    
                            var bRow = document.createElement("tr"); // CREATE ROW FOR EACH RECORD .
                            
                            
                            for (var j = 0; j < col.length; j++) {
                                var td = document.createElement("td");
                                td.innerHTML = myEntrys[i][col[j]];
                                bRow.appendChild(td);
                            }
                            tBody.appendChild(bRow)
        
                    }
                    table.appendChild(tBody);	
                    
            
                    // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                    var divContainer = document.getElementById("myTable");
                    divContainer.innerHTML = "";
                    divContainer.appendChild(table);

                    }
            } 

            function CreateChart(){
                var entryList = window.entryList;
                var chartTypes = document.getElementsByName("charttype");

                var options = {
                        chart: {
                            height: 550,
                            type: window.myChartTyp,
                        },
                        plotOptions: {
                            bar: {
                                horizontal: true,
                            }
                        },
                        dataLabels: {
                            enabled: false
                        },
                        series: [{
                            name:"Time0",
                            data: getTime0(),
                        },
                        {
                            name:"Time1",
                            data: getTime1()
                        },
                        {
                            name:"Time2",
                            data: getTime2()
                        },
                        {
                            name:"Time3",
                            data: getTime3()
                        },
                        {
                            name:"Time4",
                            data: getTime4()
                        },
                        {
                            name:"Time5",
                            data: getTime5()
                        },
                        {
                            name:"Time6",
                            data: getTime6()
                        },
                        {
                            name:"Time7",
                            data: getTime7()
                        },
                        {
                            name:"Time8",
                            data: getTime8()
                        }
                        ],
                        xaxis:{
                            categories:getVersionInfo()
                        }

                        }
                        if(window.myChartTyp == 'bar'){
                                var chart = new ApexCharts(
                                        document.querySelector("#chart"),
                                        options
                                    );
                        }else{
                            var chart = new ApexCharts(
                                        document.querySelector("#chart2"),
                                        options
                                    );  
                        }
                    window.myCharts = chart; 
                    chart.render();
                
            }

            //------------------------------------------------------------------------
            // Prepear Data for Chart

            // TIMES
            function getTime0(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time0 +',');
                }
                return(dataSeries);
            }

            function getTime1(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time1 +',');
                }
                return(dataSeries);
            }

            function getTime2(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time2 +',');
                }
                return(dataSeries);
            }

            function getTime3(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time3 +',');
                }
                return(dataSeries);
            }

            function getTime4(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time1 +',');
                }
                return(dataSeries);
            } 

            function getTime5(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time5 +',');
                }
                return(dataSeries);
            }

            function getTime6(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time6 +',');
                }
                return(dataSeries);
            } 

            function getTime7(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time7 +',');
                }
                return(dataSeries);
            } 

            function getTime8(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].time8 +',');
                }
                return(dataSeries);
            } 
            // TIMES

            function getCPU(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].cpu +',');
                }
                return(dataSeries);
            } 

            function getVersionInfo(){

                var dataSeries = [];

                for(var i = 0; i <window.entryList.length;i++){
                    dataSeries.push(entryList[i].version + '     /     '  +entryList[i].cpu);
                }
                return(dataSeries);
            } 
            function SetBar() {
                var myChart = document.getElementById('chart2');
                var myChart2 = document.getElementById('chart');
                window.myChartTyp = 'bar';
                myChart.style.visibility='hidden';
                myChart.style.height = '0px';
                myChart.style.minHeight ='0px';
                myChart2.style.visibility='visible';
                //CreateChart();
                if(window.createdBar == 1 ){

                }else{
                    CreateChart();
                    window.createdBar = 1;
                }
              }
            function SetLine() {
                
                var myChart = document.getElementById('chart');
                var myChart2 = document.getElementById('chart2');

                myChart.style.visibility='hidden';
                myChart.style.height = '0px';
                myChart.style.minHeight ='0px';
                myChart2.style.visibility='visible';
                window.myChartTyp = 'line';
                if(window.createdLine == 1 ){

                }else{
                    CreateChart();
                    window.createdLine = 1;
                }
              }


//////////////////////////////////////
var TableIDvalue = "table-header-fixed";
var TableLastSortedColumn = -1;
    function SortTable() {
        var sortColumn = parseInt(arguments[0]);
        var type = arguments.length > 1 ? arguments[1] : 'T';
        var dateformat = arguments.length > 2 ? arguments[2] : '';
        var table = document.getElementById(TableIDvalue);
        var tbody = table.getElementsByTagName("tbody")[0];
        var rows = tbody.getElementsByTagName("tr");
        var arrayOfRows = new Array();
        type = type.toUpperCase();
        dateformat = dateformat.toLowerCase();
        for(var i=0, len=rows.length; i<len; i++) {
            arrayOfRows[i] = new Object;
            arrayOfRows[i].oldIndex = i;
            var celltext = rows[i].getElementsByTagName("td")[sortColumn].innerHTML.replace(/<[^>]*>/g,"");
            if( type=='D' ) { arrayOfRows[i].value = GetDateSortingKey(dateformat,celltext); }
            else {
                var re = type=="N" ? /[^\.\-\+\d]/g : /[^a-zA-Z0-9]/g;
                arrayOfRows[i].value = celltext.replace(re,"").substr(0,25).toLowerCase();
                }
            }
        if (sortColumn == TableLastSortedColumn) { arrayOfRows.reverse(); }
        else {
            TableLastSortedColumn = sortColumn;
            switch(type) {
                case "N" : arrayOfRows.sort(CompareRowOfNumbers); break;
                case "D" : arrayOfRows.sort(CompareRowOfNumbers); break;
                default  : arrayOfRows.sort(CompareRowOfText);
                }
            }
        var newTableBody = document.createElement("tbody");
        for(var i=0, len=arrayOfRows.length; i<len; i++) {
            newTableBody.appendChild(rows[arrayOfRows[i].oldIndex].cloneNode(true));
            }
        table.replaceChild(newTableBody,tbody);
        } // function SortTable()

    function CompareRowOfText(a,b) {
        var aval = a.value;
        var bval = b.value;
        return( aval == bval ? 0 : (aval > bval ? 1 : -1) );
    } // function CompareRowOfText()

    function CompareRowOfNumbers(a,b) {
        var aval = /\d/.test(a.value) ? parseFloat(a.value) : 0;
        var bval = /\d/.test(b.value) ? parseFloat(b.value) : 0;
        return( aval == bval ? 0 : (aval > bval ? 1 : -1) );
    } // function CompareRowOfNumbers()

    function GetDateSortingKey(format,text) {
        if( format.length < 1 ) { return ""; }
        format = format.toLowerCase();
        text = text.toLowerCase();
        text = text.replace(/^[^a-z0-9]*/,"");
        text = text.replace(/[^a-z0-9]*$/,"");
        if( text.length < 1 ) { return ""; }
        text = text.replace(/[^a-z0-9]+/g,",");
        var date = text.split(",");
        if( date.length < 3 ) { return ""; }
        var d=0, m=0, y=0;
        for( var i=0; i<3; i++ ) {
            var ts = format.substr(i,1);
            if( ts == "d" ) { d = date[i]; }
            else if( ts == "m" ) { m = date[i]; }
            else if( ts == "y" ) { y = date[i]; }
            }
        d = d.replace(/^0/,"");
        if( d < 10 ) { d = "0" + d; }
        if( /[a-z]/.test(m) ) {
            m = m.substr(0,3);
            switch(m) {
                case "jan" : m = String(1); break;
                case "feb" : m = String(2); break;
                case "mar" : m = String(3); break;
                case "apr" : m = String(4); break;
                case "may" : m = String(5); break;
                case "jun" : m = String(6); break;
                case "jul" : m = String(7); break;
                case "aug" : m = String(8); break;
                case "sep" : m = String(9); break;
                case "oct" : m = String(10); break;
                case "nov" : m = String(11); break;
                case "dec" : m = String(12); break;
                default    : m = String(0);
                }
            }
        m = m.replace(/^0/,"");
        if( m < 10 ) { m = "0" + m; }
        y = parseInt(y);
        if( y < 100 ) { y = parseInt(y) + 2000; }
        return "" + String(y) + "" + String(m) + "" + String(d) + "";
    } // function GetDateSortingKey()

              

                function handleScroll(){

                }

            </script>

	</body>
</html>
